### Проект DS18B20- Реализация измерения температуры с помощью датчика Dallas DS18B20

Версия 1-Wire брутфорс, просто дергаем ногой в цикле. Данное решение отнюдь не является оптимальным как со стороны использования процесорного времени, так и со стороны оптимальности энергопотребления. 
Данный датчик достаточно точный и продвинутый, позволяет проделывать множество оптимизаций и подключение нескольких датчиков на один пин. 

> Возможные направления оптимизаций
+ Опрос датчика по прерыванию от таймера
+ Получение результата измерения по прерыванию таймера
+ Отправка по UART с запуском по прерыванию

Получение значения температуры  у DS18B20 состоит из двух этапов: команда на измерение температуры, и запрос полученного значения. Между измерением температуры и чтением должно пройти время, которое звисит от установленной точности измерений. На самой высокой точости оно равно 750мс. 

В любом случае, поскольку сам процесс измерения температуры скорее всего не является главным рабочим процессом нашего устройства, а играет подчиненную роль, и данные с датчика как-то обрабатываются и используются для конечного управления, стоит продумать частоту опроса датчика, которая необходима (при максимальной точности, одно измерение занимает 750 мс). 

Возможно, хорошей идеей будет  использование прерывания по таймеру для запуска измерения. Это освободит главный цикл нашего микроконтроллера от бесполезного ожидания в функции `delay()`, ведь наверняка у него есть другие неотложные дела :))). 

В случае корректного подключения и правильных настроек, в терминале будет выводиться считанное с датчика значение температуры.

Используется библиотека ds18b20.h

### 1) Подключим printf
 В `main.c` вверху объявляем макрос : `#define PUTCHAR_PROTOTYPE int __io_putchar(int ch);`

> Где-нибудь внизу вставляем: 
```
PUTCHAR_PROTOTYPE
{
  /* Place your implementation of fputc here */
  /* e.g. write a character to the USART1 and Loop until the end of transmission */
  HAL_UART_Transmit(&huart2, (uint8_t *)&ch, 1, 0xFFFF);

  return ch;
}
```
Для отправки данных в терминал (использовал `Putty`) используется `UART2`

### 2) In `CubeMX` активизируем `UART2` 
Используется `UART2 bod 115200` для вывода `printf`  в  терминал

> Connect computer to BluePill stm32F103C8T6

В проекте использован конвертер USB-TTL на микросхеме CH340. Если у вас не установлен драйвер на эту микросхему, вы можете [скачать его вот здесь ](https://driver.ru/?H=USB-SERIAL%20CH340&By=WCH)

>Конвертер `TTL -> USB` подключется следующим образом: 
+ `RX->A2`
+ `GND->GND`
+ `TX->A3`

### 3) Датчик подключаем к пину B11

Пин, который используется для передачи данных должен быть подтянут к питанию резистором 4.7 кОм!!
 ```
 /* USER CODE BEGIN 2 */
	port_init(); // В этой функции внутри определяется порт B11, через который будем работать
	status = ds18b20_init(SKIP_ROM); // инициализируем датчик
	printf("Init Status: %d\r\n",status); // выведем статус инициализации (0 - успешно)
/* USER CODE END 2 */
```
### 4) В main() объявляем 
```
/* USER CODE BEGIN 1 */
	uint8_t status;
	uint8_t dt[8];
	uint16_t raw_temper;
	float temper;
	char c;
/* USER CODE END 1 */  
```

  
